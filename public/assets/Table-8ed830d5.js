import{i as e,r as t,k as r,b as n,j as i}from"./index-f9649d7c.js";import{u as s}from"./useMachineHandlers-29019b02.js";import{u as a}from"./useScheduleHandlers-a3ba8b31.js";import{s as o,w as d,i as c,r as l,u as h,a as g,b as p,I as u}from"./constants-51bc6ba5.js";import{g as m,i as f,d as I,j as T}from"./moment-469476d6.js";import{u as D,b as O}from"./useDragDropManager-4b4561c8.js";import"./sweetalert2.all-37aa507a.js";import"./machinesSlice-d72c876a.js";import"./util.service-a1c9f519.js";let k=!1;class v{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;e(!k,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return k=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{k=!1}}isOver(e){return!!this.targetId&&this.internalMonitor.isOverTarget(this.targetId,e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}class C{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;this.handlerId&&(t?e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions)):this.lastConnectedDropTarget=t)}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!o(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=d({dropTarget:(e,t)=>{this.clearDropTarget(),this.dropTargetOptions=t,c(e)?this.dropTargetRef=e:this.dropTargetNode=e,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}function b(e){return t.useMemo((()=>e.hooks.dropTarget()),[e])}class M{canDrop(){const e=this.spec,t=this.monitor;return!e.canDrop||e.canDrop(t.getItem(),t)}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function N(r,n,i){const s=D(),a=function(e,r){const n=t.useMemo((()=>new M(e,r)),[r]);return t.useEffect((()=>{n.spec=e}),[e]),n}(r,n),o=function(r){const{accept:n}=r;return t.useMemo((()=>(e(null!=r.accept,"accept must be defined"),Array.isArray(n)?n:[n])),[n])}(r);O((function(){const[e,t]=l(o,a,s);return n.receiveHandlerId(e),i.receiveHandlerId(e),t}),[s,n,a,i,o.map((e=>e.toString())).join("|")])}function w(e,r){const n=h(e,r),i=function(){const e=D();return t.useMemo((()=>new v(e)),[e])}(),s=function(e){const r=D(),n=t.useMemo((()=>new C(r.getBackend())),[r]);return O((()=>(n.dropTargetOptions=e||null,n.reconnect(),()=>n.disconnectDropTarget())),[e]),n}(n.options);return N(n,i,s),[g(n.collect,i,s),b(s)]}const H=({worker:e,isLocked:s,details:a})=>{const o=t.useRef(null),[d,c]=t.useState(s),l=r(),[h]=m(),[g]=f(),[D]=I(),[O]=T(),[{isDragging:k},v]=p((()=>({type:u.WORKER,collect:e=>({isDragging:!!e.isDragging()}),item:()=>({...a,name:e?.name}),canDrag:()=>!s&&!!e})),[s,e]),[{isOver:C},b]=w((()=>({accept:u.WORKER,collect:e=>({isOver:!!e.isOver()&&!s,handlerId:e.getHandlerId()}),canDrop:()=>!s,drop(t){console.log("HEYY!!",t,a,e),"_id"in t?D({destinationDetails:a,worker:t,scheduleId:l.scheduleId}):o.current&&(t.idx===a.idx&&t.machineId===a.machineId&&t.shiftTime===a.shiftTime||h({from:a,to:t,scheduleId:l.scheduleId}))}})),[s]);return v(b(o)),n("article",{ref:o,onMouseOver:e=>{s||c(!0)},onMouseLeave:e=>{s||c(!1)},className:`worker-item\n      ${e?"":"empty"}\n      ${s?"locked":""}\n      ${C?"over":""}\n      ${k?"drag":""}`,children:[e?.name,d?i("span",{className:"material-symbols-outlined thick icon-lock icon "+(s?"active":""),onClick:e=>{g({workerDetails:a,scheduleId:l.scheduleId})},children:""}):null,i("span",{className:"material-symbols-outlined thick icon-remove icon",onClick:t=>{O({destinationDetails:a,worker:e,scheduleId:l.scheduleId})},children:""})]})},j=({data:e,locked:t,details:r})=>i("div",{className:"cell",children:e.map(((e,n)=>i(H,{worker:e,isLocked:t[n],details:{...r,idx:n}},`${r.machineId}-${r.shiftTime} -${n}`)))}),R=({table:e})=>{const{handleAmountOfWorkersChange:t}=a(),{handleImportanceChange:r}=s();return n("div",{className:"main-table",children:[n("div",{className:"row row-header",children:[i("div",{className:"cell cell-header",children:"מכונות"}),i("div",{className:"cell cell-header",children:"בוקר"}),i("div",{className:"cell cell-header",children:"ערב"}),i("div",{className:"cell cell-header",children:"לילה"})]}),e.map((e=>n("div",{className:"row",children:[n("div",{className:"cell cell-title",children:[i("span",{className:"title",children:e.machine.name}),n("div",{className:"info",children:[i("span",{onClick:()=>r(e.machine),className:"importance",children:`(${e.machine.importance})`}),i("span",{onClick:()=>t(e.machine),className:"workers",children:`(${e.machine.amountOfWorkers})`})]})]}),i(j,{data:e.data.morning,locked:e.locked.morning,details:{machineId:e.machine._id,shiftTime:"morning"}}),i(j,{data:e.data.evening,locked:e.locked.evening,details:{machineId:e.machine._id,shiftTime:"evening"}}),i(j,{data:e.data.night,locked:e.locked.night,details:{machineId:e.machine._id,shiftTime:"night"}})]},e.machine._id)))]})};export{R as Table,R as default};
