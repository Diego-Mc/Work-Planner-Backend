import{i as T,r as o,k as H,d as l,j as s}from"./index-6e080c71.js";import{u as W}from"./useMachineHandlers-f3dce9c5.js";import{u as S}from"./useScheduleHandlers-74bd7cad.js";import{s as $,w as E,i as j,r as _,u as x,a as A,b as F,I as f}from"./constants-9f645d5d.js";import{g as P,i as Y,d as K,j as q}from"./moment-601c7010.js";import{u as m,b as I}from"./useDragDropManager-f75fa5a2.js";import"./sweetalert2.all-ea6aa349.js";import"./machinesSlice-7ef1c114.js";import"./util.service-ffb50af9.js";let g=!1;class B{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;T(!g,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return g=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{g=!1}}isOver(e){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,e):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}class U{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;if(this.handlerId){if(!t){this.lastConnectedDropTarget=t;return}e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions))}}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!$(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=E({dropTarget:(t,n)=>{this.clearDropTarget(),this.dropTargetOptions=n,j(t)?this.dropTargetRef=t:this.dropTargetNode=t,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}function z(r){return o.useMemo(()=>r.hooks.dropTarget(),[r])}function G(r){const e=m(),t=o.useMemo(()=>new U(e.getBackend()),[e]);return I(()=>(t.dropTargetOptions=r||null,t.reconnect(),()=>t.disconnectDropTarget()),[r]),t}function J(){const r=m();return o.useMemo(()=>new B(r),[r])}function L(r){const{accept:e}=r;return o.useMemo(()=>(T(r.accept!=null,"accept must be defined"),Array.isArray(e)?e:[e]),[e])}class Q{canDrop(){const e=this.spec,t=this.monitor;return e.canDrop?e.canDrop(t.getItem(),t):!0}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function V(r,e){const t=o.useMemo(()=>new Q(r,e),[e]);return o.useEffect(()=>{t.spec=r},[r]),t}function X(r,e,t){const n=m(),i=V(r,e),d=L(r);I(function(){const[h,u]=_(d,i,n);return e.receiveHandlerId(h),t.receiveHandlerId(h),u},[n,e,i,t,d.map(c=>c.toString()).join("|")])}function Z(r,e){const t=x(r,e),n=J(),i=G(t.options);return X(t,n,i),[A(t.collect,n,i),z(i)]}const w=({worker:r,isLocked:e,details:t})=>{const n=o.useRef(null),[i,d]=o.useState(e),c=H(),[h]=P(),[u]=Y(),[D]=K(),[C]=q(),O=a=>{e||d(!0)},v=a=>{e||d(!1)},M=a=>{u({workerDetails:t,scheduleId:c.scheduleId})},b=a=>{C({destinationDetails:t,worker:r,scheduleId:c.scheduleId})},[{isDragging:N},k]=F(()=>({type:f.WORKER,collect:a=>({isDragging:!!a.isDragging()}),item:()=>({...t,name:r==null?void 0:r.name}),canDrag(){return!e&&!!r}}),[e,r]),[{isOver:R},y]=Z(()=>({accept:f.WORKER,collect(a){return{isOver:!!a.isOver()&&!e,handlerId:a.getHandlerId()}},canDrop(){return!e},drop(a){if(console.log("HEYY!!",a,t,r),"_id"in a){D({destinationDetails:t,worker:a,scheduleId:c.scheduleId});return}n.current&&(a.idx===t.idx&&a.machineId===t.machineId&&a.shiftTime===t.shiftTime||h({from:t,to:a,scheduleId:c.scheduleId}))}}),[e]);return k(y(n)),l("article",{ref:n,onMouseOver:O,onMouseLeave:v,className:`worker-item
      ${r?"":"empty"}
      ${e?"locked":""}
      ${R?"over":""}
      ${N?"drag":""}`,children:[r==null?void 0:r.name,i?s("span",{className:`material-symbols-outlined thick icon-lock icon ${e?"active":""}`,onClick:M,children:"lock"}):null,s("span",{className:"material-symbols-outlined thick icon-remove icon",onClick:b,children:"close"})]})},p=({data:r,locked:e,details:t})=>s("div",{className:"cell",children:r.map((n,i)=>s(w,{worker:n,isLocked:e[i],details:{...t,idx:i}},`${t.machineId}-${t.shiftTime} -${i}`))}),le=({table:r})=>{const{handleAmountOfWorkersChange:e}=S(),{handleImportanceChange:t}=W();return l("div",{className:"main-table",children:[l("div",{className:"row row-header",children:[s("div",{className:"cell cell-header",children:"מכונות"}),s("div",{className:"cell cell-header",children:"בוקר"}),s("div",{className:"cell cell-header",children:"ערב"}),s("div",{className:"cell cell-header",children:"לילה"})]}),r.map(n=>l("div",{className:"row",children:[l("div",{className:"cell cell-title",children:[s("span",{className:"title",children:n.machine.name}),l("div",{className:"info",children:[s("span",{onClick:()=>t(n.machine),className:"importance",children:`(${n.machine.importance})`}),s("span",{onClick:()=>e(n.machine),className:"workers",children:`(${n.machine.amountOfWorkers})`})]})]}),s(p,{data:n.data.morning,locked:n.locked.morning,details:{machineId:n.machine._id,shiftTime:"morning"}}),s(p,{data:n.data.evening,locked:n.locked.evening,details:{machineId:n.machine._id,shiftTime:"evening"}}),s(p,{data:n.data.night,locked:n.locked.night,details:{machineId:n.machine._id,shiftTime:"night"}})]},n.machine._id))]})};export{le as Table,le as default};
